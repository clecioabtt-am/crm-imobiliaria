<!doctype html>
<html lang="pt-br"><head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Imóveis - CRM</title>
<link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div class="container">
  <div id="nav"></div>

  <div class="card">
    <div class="row">
      <h2>Imóveis</h2>
      <span class="small">CRUD básico</span>
    </div>

    <div class="card">
      <h3>Novo</h3>
      <div class="grid">

      <div>
        <label>Título</label>
        <input class="input" id="title" type="text" placeholder="Ex: Apto 2Q - Centro"/>
      </div>


      <div>
        <label>Tipo</label>
        <input class="input" id="type" type="text" placeholder="Apartamento"/>
      </div>


      <div>
        <label>Bairro</label>
        <input class="input" id="neighborhood" type="text" placeholder="Centro"/>
      </div>


      <div>
        <label>Cidade</label>
        <input class="input" id="city" type="text" placeholder="Manaus"/>
      </div>


      <div>
        <label>Preço</label>
        <input class="input" id="price" type="number" placeholder="350000"/>
      </div>


      <div>
        <label>Finalidade</label>
        <input class="input" id="purpose" type="text" placeholder="Venda"/>
      </div>


      <div>
        <label>Status</label>
        <input class="input" id="status" type="text" placeholder="Disponível"/>
      </div>


      <div>
        <label>Descrição</label>
        <input class="input" id="description" type="text" placeholder=""/>
      </div>

      </div>
      <div style="margin-top:12px" class="row">
        <button class="btn" id="create">Salvar</button>
        <span class="small" id="msg"></span>
      </div>
    </div>

    <table class="table" id="tbl">
      <thead><tr><th>ID</th><th>Resumo</th><th class="small">Ações</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script src="js/app.js"></script>
<script>
requireAuth();
document.getElementById("nav").innerHTML = navHtml();

async function load(){
  const rows = await api("/api/properties");
  const tb = document.querySelector("#tbl tbody");
  tb.innerHTML = "";
  rows.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `${r.id}</td><td><b>${r.title}</b><div class="small">${r.purpose} • R$ ${Number(r.price).toFixed(2)} • ${r.neighborhood} (${r.city}) • ${r.status}</div></td><td>-</td>`;
    tb.appendChild(tr);
  });
}

document.getElementById("create").onclick = async () => {
  const msg = document.getElementById("msg");
  msg.textContent = "Salvando...";
  try {
    const payload = ({
      title: document.getElementById("title").value,
      type: document.getElementById("type").value || "Apartamento",
      neighborhood: document.getElementById("neighborhood").value || "",
      city: document.getElementById("city").value || "",
      price: Number(document.getElementById("price").value || 0),
      purpose: document.getElementById("purpose").value || "Venda",
      status: document.getElementById("status").value || "Disponível",
      description: document.getElementById("description").value || ""
    });
    await api("/api/properties","POST", payload);
    msg.textContent = "Salvo!";
    await load();
  } catch(e) {
    msg.textContent = e.message;
  }
};

load();
</script>
</body></html>
